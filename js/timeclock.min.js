function contains(t,d,e){for(var s=0;s<t.length;s++)if(t[s][d]===e)return!0;return!1}function isBetweeen(t,d,e){var s=t.substring(0,2),r=d.substring(0,2),n=e.substring(0,2),a=t.substring(2),i=d.substring(2),u=e.substring(2);return s===r&&r===n&&(a<=i&&i<=u)}function colorize(t,d,e){if(t.substring(0,2)===d.substring(0,2))for(var s,r=t.substring(0,2),n=parseInt(t.substring(2)),a=parseInt(d.substring(2));n<=a;)s=n<10?r+"000"+n:n<100?r+"00"+n:n<1e3?r+"0"+n:r+n,n+=n%100!=0?70:30,$("#"+s).css("background-color",e)}function formatize(t){return t<10?"000"+t:t<100?"00"+t:t<1e3?"0"+t:t}function substractOne(t){var d=t.substring(0,2),e=t;return e=parseInt(e.substring(2)),d+(e=formatize(e-=e%100!=0?30:70))}function addOne(t){var d=t.substring(0,2),e=t;return e=parseInt(e.substring(2)),d+(e=formatize(e+=e%100!=0?70:30))}function isNeighbourOf(t,d){var e=addOne(t.end),s=addOne(d.end);return e===d.start||s===t.start}function isBorderOf(t,d){return!(t.start!==d.start||!isBetweeen(t.start,d.end,t.end))||(!(d.start!==t.start||!isBetweeen(d.start,t.end,d.end))||(!(t.end!==d.end||!isBetweeen(t.start,d.start,t.end))||!(d.end!==t.end||!isBetweeen(d.start,t.start,d.end))))}function overlaps(t,d){return!(!isBetweeen(t.start,d.start,t.end)||isBetweeen(t.start,d.end,t.end))||!(!isBetweeen(d.start,t.start,d.end)||isBetweeen(d.start,t.end,d.end))}Array.prototype.removeValue=function(t,d){var e=$.map(this,function(e,s){return e[t]===d?null:e});this.length=0,this.push.apply(this,e)},$(document).ready(function(){for(var t=$("#timeclock-container"),d=(document.createElement("table"),"<table id='timeclock'><tr><th style='border: none;'></th><th colspan='4'>00:00</th><th colspan='4'>02:00</th><th colspan='4'>04:00</th><th colspan='4'>06:00</th><th colspan='4'>08:00</th><th colspan='4'>10:00</th><th colspan='4'>12:00</th><th colspan='4'>14:00</th><th colspan='4'>16:00</th><th colspan='4'>18:00</th><th colspan='4'>20:00</th><th colspan='4'>22:00</th></tr>"),e=["mo","tu","we","th","fr","sa","su"],s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r=0;r<e.length;r++)d+='<tr><td class="head">'+s[r]+"</td><td id='"+e[r]+"0000'></td><td id='"+e[r]+"0030'></td><td id='"+e[r]+"0100'></td><td id='"+e[r]+"0130'></td><td id='"+e[r]+"0200'></td><td id='"+e[r]+"0230'></td><td id='"+e[r]+"0300'></td><td id='"+e[r]+"0330'></td><td id='"+e[r]+"0400'></td><td id='"+e[r]+"0430'></td><td id='"+e[r]+"0500'></td><td id='"+e[r]+"0530'></td><td id='"+e[r]+"0600'></td><td id='"+e[r]+"0630'></td><td id='"+e[r]+"0700'></td><td id='"+e[r]+"0730'></td><td id='"+e[r]+"0800'></td><td id='"+e[r]+"0830'></td><td id='"+e[r]+"0900'></td><td id='"+e[r]+"0930'></td><td id='"+e[r]+"1000'></td><td id='"+e[r]+"1030'></td><td id='"+e[r]+"1100'></td><td id='"+e[r]+"1130'></td><td id='"+e[r]+"1200'></td><td id='"+e[r]+"1230'></td><td id='"+e[r]+"1300'></td><td id='"+e[r]+"1330'></td><td id='"+e[r]+"1400'></td><td id='"+e[r]+"1430'></td><td id='"+e[r]+"1500'></td><td id='"+e[r]+"1530'></td><td id='"+e[r]+"1600'></td><td id='"+e[r]+"1630'></td><td id='"+e[r]+"1700'></td><td id='"+e[r]+"1730'></td><td id='"+e[r]+"1800'></td><td id='"+e[r]+"1830'></td><td id='"+e[r]+"1900'></td><td id='"+e[r]+"1930'></td><td id='"+e[r]+"2000'></td><td id='"+e[r]+"2030'></td><td id='"+e[r]+"2100'></td><td id='"+e[r]+"2130'></td><td id='"+e[r]+"2200'></td><td id='"+e[r]+"2230'></td><td id='"+e[r]+"2300'></td><td id='"+e[r]+"2330'></td></tr><tr class='separator'><td colspan='49' class='separator-cell'></td></tr>";d+="</table>",t.first().after(d);var n,a=[],i=[],u=$("#timeclockInput");if(null===u.val()||""===u.val())n=[];else{n=JSON.parse(u.val()),console.log(JSON.parse(u.val()));for(var o=0;o<n.length;o++)colorize(n[o].start,n[o].end,"lightblue")}$("#timeclock").on("mousedown",function(t){var d,e,s,r;$(t.target).hasClass("separator-cell")||(d=t.target.id,$("#"+d).css("background-color","lightgreen"),$("#timeclock").on("mouseup",function(t){if(e=t.target.id,null!==d&&null!==e){s=d.substring(0,2);for(var o=!1,l=0;l<n.length;l++)if(n[l].start.substring(0,2)===s)if(d===n[l].start&&e===n[l].end&&(a.push({start:n[l].start,end:n[l].end}),o=!0),isBetweeen(d,n[l].start,e)&&isBetweeen(d,n[l].end,e))a.push({start:n[l].start,end:n[l].end});else if(isBetweeen(n[l].start,d,n[l].end)&&isBetweeen(n[l].start,e,n[l].end)&&!isBorderOf(n[l],{start:d,end:e})){var c=n[l].start,h=addOne(e),g=substractOne(d),p=n[l].end;a.push({start:n[l].start,end:n[l].end}),o=!0,i.push({start:c,end:g}),i.push({start:h,end:p})}else isNeighbourOf(n[l],{start:d,end:e})?(o=!0,a.push({start:n[l].start,end:n[l].end}),parseInt(n[l].start.substring(2))<parseInt(d.substring(2))?i.push({start:n[l].start,end:e}):parseInt(n[l].start.substring(2))>parseInt(d.substring(2))&&i.push({start:d,end:n[l].end})):isBorderOf(n[l],{start:d,end:e})&&(a.push({start:n[l].start,end:n[l].end}),o=!0,n[l].start===d?i.push({start:addOne(e),end:n[l].end}):n[l].end===e&&i.push({start:n[l].start,end:substractOne(d)}));for(var f=0;f<a.length;f++)colorize(a[f].start,a[f].end,"white"),n.removeValue("start",a[f].start);for(var b=0;b<i.length;b++)if(-1!==i[b]){if(i.length>b+1&&overlaps(i[b+1],i[b])){parseInt(i[b+1].start.substring(2))<parseInt(i[b].start.substring(2))?(colorize(i[b+1].start,i[b].end,"lightgreen"),n.push({start:i[b+1].start,end:i[b].end})):parseInt(i[b+1].start.substring(2))>parseInt(i[b].start.substring(2))&&(colorize(i[b].start,i[b+1].end,"lightgreen"),n.push({start:i[b].start,end:i[b+1].end})),i[b+1]=-1;continue}colorize(i[b].start,i[b].end,"lightgreen"),n.push({start:i[b].start,end:i[b].end})}a=[],i=[],o||d.substring(0,2)===e.substring(0,2)&&(colorize(d,e,"lightgreen"),n.push({start:d,end:e}),r=2),e=null,d=null,u.val(JSON.stringify(n))}else r=1}),1===r&&$("#"+d).css("background-color","white"))})});